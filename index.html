<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minesweeper Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="config.js"></script>
</head>
<body>
    <div id="btn-mute" onclick="toggleMuteUI()">ğŸ”Š</div>
    <a href="https://exotic08.github.io/Hub/" class="btn-hub">ğŸ® HUB</a>
    <div id="user-badge" class="user-badge" style="position: absolute; top: 20px; right: 20px; z-index: 100; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.15); padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; display: none; align-items: center; gap: 8px; cursor: pointer;" onclick="App.editProfile()"><span>ğŸ‘¤ <span id="u-name">...</span></span> <span style="font-size: 0.8rem; opacity: 0.7;">âœï¸</span></div>

    <div id="screen-login" class="screen active" style="justify-content: center;">
        <div class="card">
            <h1>ÄÄ‚NG NHáº¬P</h1>
            <div class="input-group" style="text-align: left; width: 100%;">
                <span class="input-label" style="display:block; margin-bottom:5px; font-weight:bold;">TÃªn ngÆ°á»i chÆ¡i</span>
                <input type="text" id="inp-name" placeholder="VÃ­ dá»¥: ProGamer" maxlength="12">
            </div>
            <button class="btn btn-primary" id="btn-login" onclick="App.login()" style="width:100%">Báº®T Äáº¦U</button>
            <button class="btn btn-danger" id="btn-cancel-login" onclick="App.showMenu()" style="width:100%; display:none;">Há»¦Y Bá»</button>
        </div>
    </div>

    <div id="screen-slogan" class="screen" style="justify-content: center;">
        <div class="card"><h1>Há»’ SÆ </h1><h3 id="welcome-user" style="color:#3b82f6; margin-bottom: 20px;"></h3><div class="input-group" style="text-align: left; width: 100%;"><span class="input-label" style="display:block; margin-bottom:5px; font-weight:bold;">MÃ´ táº£ / Slogan (Ngáº¯n gá»n)</span><input type="text" id="inp-desc" placeholder="VÃ­ dá»¥: Báº¥t báº¡i!" maxlength="25"></div><button class="btn btn-primary" onclick="App.saveSlogan()" style="width:100%">HOÃ€N Táº¤T</button></div>
    </div>

    <div id="screen-menu" class="screen screen-menu" style="justify-content: center; padding-top: 40px;">
        <h1 style="margin-bottom: 30px;">MINESWEEPER</h1>
        
        <div id="menu-top" class="menu-group">
            <button class="btn-menu btn-classic" onclick="window.location.href='choi.html'">
                <div style="display:flex; align-items:center;"><div class="btn-icon-large">ğŸ’£</div><div class="btn-text"><span class="btn-title">CHÆ I ÄÆ N</span><span class="btn-sub">Luyá»‡n táº­p ká»¹ nÄƒng</span></div></div><div style="font-size:1.5rem">â¡ï¸</div>
            </button>
            <button class="btn-menu btn-pvp-mode" onclick="window.location.href='choi.html?mode=pvp'">
                <div style="display:flex; align-items:center;"><div class="btn-icon-large">âš”ï¸</div><div class="btn-text"><span class="btn-title">Äáº¤U PVP</span><span class="btn-sub">Äang chá»: <span id="stat-wait" style="font-weight:900; color:#fcd34d">0</span></span></div></div><div style="font-size:1.5rem">ğŸ”¥</div>
            </button>
        </div>

        <button class="btn-menu btn-fun" onclick="App.toggleFun()" id="btn-fun-mode">
            <div style="display:flex; align-items:center;"><div class="btn-icon-large">ğŸª</div><div class="btn-text"><span class="btn-title">GIáº¢I TRÃ</span><span class="btn-sub">Gá»¡ bom, Boss...</span></div></div><div style="font-size:1.5rem" id="fun-arrow">â¬‡ï¸</div>
        </button>

        <div id="menu-sub" class="menu-sub">
            <button class="btn-menu" onclick="window.location.href='datbom.html'" style="background: rgba(13, 148, 136, 0.4); border: 1px solid #2dd4bf;">
                <div style="display:flex; align-items:center;"><div class="btn-icon-large">ğŸ’£</div><div class="btn-text"><span class="btn-title">Gá»  BOM</span><span class="btn-sub">TÃ¬m 10 quáº£ mÃ¬n</span></div></div>
            </button>
            <button class="btn-menu" onclick="window.location.href='giaitri.html'" style="background: rgba(124, 58, 237, 0.4); border: 1px solid #a855f7;">
                <div style="display:flex; align-items:center;"><div class="btn-icon-large">ğŸ‘¹</div><div class="btn-text"><span class="btn-title">Äáº I CHIáº¾N BOSS</span><span class="btn-sub">RPG Minesweeper</span></div></div>
            </button>
        </div>

        <div id="menu-bottom" class="menu-group">
            <div class="menu-grid">
                <div class="btn-grid-item btn-skin" onclick="App.showScreen('skins')">
                    <div style="font-size:1.8rem; margin-bottom:5px;">ğŸ¨</div><div style="font-weight:700;">Skin</div>
                </div>
                <div class="btn-grid-item btn-rank" onclick="window.location.href='xephang.html'">
                    <div style="font-size:1.8rem; margin-bottom:5px;">ğŸ†</div><div style="font-weight:700;">Rank</div>
                </div>
                <div class="btn-grid-item btn-grid-full btn-ach" onclick="window.location.href='thanhtuu.html'">
                    <div style="font-size:1.8rem;">ğŸ–ï¸</div><div style="font-weight:700;">ThÃ nh Tá»±u & Huy Hiá»‡u</div>
                </div>
            </div>
            <button class="btn-menu btn-logout" onclick="App.logout()">ÄÄ‚NG XUáº¤T</button>
            <div style="margin-top:15px; color:#64748b; font-size:0.7rem; font-family:monospace;">Ver: 30.0 (Ultra Fluid)</div>
        </div>
    </div>

    <div id="screen-skins" class="screen" style="justify-content: center;">
        <div class="game-header"><button class="btn-icon" onclick="App.showMenu()">â¬…</button><h2 style="margin:0">TRANG Bá»Š SKIN</h2><div style="width: 44px;"></div></div>
        <p style="color:#94a3b8; font-size:0.9rem; margin-bottom:15px; text-align:center;">Skin chá»‰ hiá»ƒn thá»‹ khi vÃ o mÃ n chÆ¡i game.</p>
        <div id="skin-list" style="width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 50px;"></div>
    </div>

    <script>
        const LocalState = { user: null, data: {}, isEditing: false };
        window.App = window.App || {}; 

        function toggleMuteUI() {
            if(window.SoundManager) {
                const muted = window.SoundManager.toggleMute();
                const btn = document.getElementById('btn-mute');
                btn.innerText = muted ? 'ğŸ”‡' : 'ğŸ”Š';
                btn.classList.toggle('muted', muted);
            }
        }

        window.App.init = () => {
            const savedUser = localStorage.getItem('ms_user');
            if (savedUser) {
                LocalState.user = savedUser;
                App.finishLogin();
            } else {
                document.getElementById('screen-login').classList.add('active');
            }
            if(window.App.applySkin) window.App.applySkin();
            if(window.SoundManager) window.SoundManager.init();
            
            try {
                db.ref('waiting').on('value', snap => {
                    const count = snap.exists() ? Object.keys(snap.val()).length : 0;
                    const el = document.getElementById('stat-wait');
                    if(el) el.innerText = count;
                });
            } catch(e) { console.log("Firebase wait error", e); }
        };

        window.App.toggleFun = () => {
            const top = document.getElementById('menu-top');
            const bottom = document.getElementById('menu-bottom');
            const sub = document.getElementById('menu-sub');
            const arrow = document.getElementById('fun-arrow');
            
            if (sub.classList.contains('show')) {
                sub.classList.remove('show');
                top.classList.remove('hidden');
                bottom.classList.remove('hidden');
                arrow.innerText = 'â¬‡ï¸';
                document.getElementById('btn-fun-mode').style.background = '';
            } else {
                top.classList.add('hidden');
                bottom.classList.add('hidden');
                sub.classList.add('show');
                arrow.innerText = 'â¬†ï¸';
                document.getElementById('btn-fun-mode').style.background = 'rgba(168, 85, 247, 0.2)';
            }
        };

        window.App.renderSkins = () => {
            const currentSkin = localStorage.getItem('ms_skin') || 'default';
            const container = document.getElementById('skin-list');
            container.innerHTML = '';
            const skins = window.SKINS || [];
            skins.forEach(skin => {
                const isActive = skin.id === currentSkin;
                const btn = document.createElement('div');
                btn.style.cssText = `padding: 15px; cursor: pointer; transition: 0.2s; border: 3px solid ${isActive ? '#10b981' : 'transparent'}; background: ${skin.color}; color: ${skin.id === 'default' ? 'white' : 'black'}; display: flex; align-items: center; gap: 15px; text-align: left; border-radius: 16px; opacity: ${isActive ? '1' : '0.8'}; transform: ${isActive ? 'scale(1.02)' : 'scale(1)'}; box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin-bottom: 10px;`;
                btn.onclick = () => { localStorage.setItem('ms_skin', skin.id); window.App.renderSkins(); };
                btn.innerHTML = `<div style="font-size: 2rem;">${skin.id === 'classic' ? 'ğŸªŸ' : (skin.id === 'pink' ? 'ğŸŒ¸' : 'ğŸ’ ')}</div><div style="flex: 1;"><div style="font-weight: 900; font-size: 1.1rem;">${skin.name}</div><div style="font-size: 0.8rem; opacity: 0.8;">${skin.desc}</div></div><div style="font-size: 1.5rem;">${isActive ? 'âœ…' : ''}</div>`;
                container.appendChild(btn);
            });
        };

        window.App.login = () => {
            const name = document.getElementById('inp-name').value.trim().replace(/[^a-zA-Z0-9]/g, "");
            if (name.length < 2) return alert("TÃªn quÃ¡ ngáº¯n!");
            document.getElementById('btn-login').innerText = "Äang táº£i...";
            LocalState.user = name;
            db.ref('users/' + name).once('value').then(snap => {
                if (snap.exists()) {
                    LocalState.data = snap.val();
                    if (!LocalState.data.achievements) LocalState.data.achievements = {};
                    if (LocalState.isEditing) {
                        document.getElementById('inp-desc').value = LocalState.data.desc || "";
                        document.getElementById('welcome-user').innerText = `Cáº­p nháº­t: ${name}`;
                        App.showScreen('slogan');
                    } else {
                        localStorage.setItem('ms_user', name);
                        App.finishLogin();
                    }
                } else {
                    LocalState.data = { wins: 0, losses: 0, desc: "", achievements: {} };
                    document.getElementById('welcome-user').innerText = `Xin chÃ o ${name}!`;
                    App.showScreen('slogan');
                }
            }).catch(e => { alert("Lá»—i káº¿t ná»‘i: " + e.message); document.getElementById('btn-login').innerText = "TIáº¾P Tá»¤C"; });
        };

        window.App.saveSlogan = () => {
            const desc = document.getElementById('inp-desc').value.trim();
            LocalState.data.desc = desc;
            db.ref('users/' + LocalState.user).update(LocalState.data).then(() => { localStorage.setItem('ms_user', LocalState.user); LocalState.isEditing = false; App.finishLogin(); });
        };

        window.App.finishLogin = () => {
            document.getElementById('u-name').innerText = LocalState.user;
            document.getElementById('user-badge').style.display = 'flex';
            document.getElementById('btn-login').innerText = "TIáº¾P Tá»¤C";
            document.getElementById('btn-cancel-login').style.display = 'none';
            App.showMenu();
        };

        window.App.editProfile = () => {
            LocalState.isEditing = true;
            document.getElementById('inp-name').value = LocalState.user;
            document.getElementById('btn-login').innerText = "Cáº¬P NHáº¬T";
            document.getElementById('btn-cancel-login').style.display = 'block';
            App.showScreen('login');
        };

        window.App.logout = () => { localStorage.removeItem('ms_user'); location.reload(); };
        window.App.showMenu = () => { LocalState.isEditing = false; App.showScreen('menu'); };
        window.App.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
            const target = document.getElementById('screen-' + id);
            if(target) { target.classList.add('active'); target.style.display = 'flex'; }
            if (id === 'skins') { window.App.renderSkins(); }
        };
        window.onload = window.App.init;
    </script>
</body>
</html>
