<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <title>Minesweeper Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="config.js"></script>
</head>
<body>

    <a href="https://exotic08.github.io/Hub/" class="btn-hub">
        ğŸ® HUB
    </a>

    <div id="user-badge" class="user-badge" style="position: absolute; top: 20px; right: 20px; z-index: 100; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.15); padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; display: none; align-items: center; gap: 8px; cursor: pointer;" onclick="App.editProfile()">
        <span>ğŸ‘¤ <span id="u-name">...</span></span> 
        <span style="font-size: 0.8rem; opacity: 0.7;">âœï¸</span>
    </div>

    <div id="screen-login" class="screen active" style="justify-content: center;">
        <div class="card">
            <h1>ÄÄ‚NG NHáº¬P</h1>
            <div class="input-group" style="text-align: left; width: 100%;">
                <span class="input-label" style="display:block; margin-bottom:5px; font-weight:bold;">TÃªn ngÆ°á»i chÆ¡i</span>
                <input type="text" id="inp-name" placeholder="VÃ­ dá»¥: ProGamer" maxlength="12">
            </div>
            <button class="btn btn-primary" id="btn-login" onclick="App.login()" style="width:100%">Báº®T Äáº¦U</button>
            <button class="btn btn-danger" id="btn-cancel-login" onclick="App.showMenu()" style="width:100%; display:none;">Há»¦Y Bá»</button>
        </div>
    </div>

    <div id="screen-slogan" class="screen" style="justify-content: center;">
        <div class="card">
            <h1>Há»’ SÆ </h1>
            <h3 id="welcome-user" style="color:#3b82f6; margin-bottom: 20px;"></h3>
            <div class="input-group" style="text-align: left; width: 100%;">
                <span class="input-label" style="display:block; margin-bottom:5px; font-weight:bold;">MÃ´ táº£ / Slogan (Ngáº¯n gá»n)</span>
                <input type="text" id="inp-desc" placeholder="VÃ­ dá»¥: Báº¥t báº¡i!" maxlength="25">
            </div>
            <button class="btn btn-primary" onclick="App.saveSlogan()" style="width:100%">HOÃ€N Táº¤T</button>
        </div>
    </div>

    <div id="screen-menu" class="screen screen-menu" style="justify-content: center; padding-top: 40px;">
        <h1 style="margin-bottom: 30px; font-size: 2.5rem; text-shadow: 0 0 20px rgba(59,130,246,0.5);">MINESWEEPER</h1>
        
        <button class="btn-menu btn-classic" onclick="window.location.href='choi.html'">
            <div style="display:flex; align-items:center;">
                <div class="btn-icon-large">ğŸ’£</div>
                <div class="btn-text">
                    <span class="btn-title">CHÆ I ÄÆ N</span>
                    <span class="btn-sub">Luyá»‡n táº­p ká»¹ nÄƒng</span>
                </div>
            </div>
            <div style="font-size:1.5rem">â¡ï¸</div>
        </button>

        <button class="btn-menu btn-pvp-mode" onclick="window.location.href='choi.html?mode=pvp'">
            <div style="display:flex; align-items:center;">
                <div class="btn-icon-large">âš”ï¸</div>
                <div class="btn-text">
                    <span class="btn-title">Äáº¤U PVP</span>
                    <span class="btn-sub">Äang chá»: <span id="stat-wait" style="font-weight:900; color:#fcd34d">0</span></span>
                </div>
            </div>
            <div style="font-size:1.5rem">ğŸ”¥</div>
        </button>

        <button class="btn-menu btn-fun" onclick="window.location.href='giaitri.html'">
            <div style="display:flex; align-items:center;">
                <div class="btn-icon-large">ğŸ‘¹</div>
                <div class="btn-text">
                    <span class="btn-title">Äáº I CHIáº¾N BOSS</span>
                    <span class="btn-sub">Cháº¿ Ä‘á»™ giáº£i trÃ­</span>
                </div>
            </div>
            <div style="font-size:1.5rem">ğŸª</div>
        </button>

        <div class="menu-grid">
            <button class="btn-menu btn-skin" onclick="App.showScreen('skins')">
                <div class="btn-icon-large" style="margin:0 0 5px 0;">ğŸ¨</div>
                <span class="btn-title" style="font-size:0.9rem">SKIN</span>
            </button>

            <button class="btn-menu btn-rank" onclick="window.location.href='xephang.html'">
                <div class="btn-icon-large" style="margin:0 0 5px 0;">ğŸ†</div>
                <span class="btn-title" style="font-size:0.9rem">Xáº¾P Háº NG</span>
            </button>

            <button class="btn-menu btn-ach" onclick="window.location.href='thanhtuu.html'">
                <span style="font-size:1.5rem">ğŸ–ï¸</span>
                <span class="btn-title" style="font-size:1rem">THÃ€NH Tá»°U & HUY HIá»†U</span>
            </button>
        </div>

        <button class="btn-menu btn-logout" onclick="App.logout()">
            ÄÄ‚NG XUáº¤T
        </button>
        
        <div style="position:absolute; bottom:20px; color:#64748b; font-size:0.7rem; font-family:monospace;">
            Ver: 25.3 (Ultra UI)
        </div>
    </div>

    <div id="screen-skins" class="screen" style="justify-content: center;">
        <div class="game-header">
            <button class="btn-icon" onclick="App.showMenu()">â¬…</button>
            <h2 style="margin:0">TRANG Bá»Š SKIN</h2>
            <div style="width: 44px;"></div>
        </div>
        <p style="color:#94a3b8; font-size:0.9rem; margin-bottom:15px; text-align:center;">Skin chá»‰ hiá»ƒn thá»‹ khi vÃ o mÃ n chÆ¡i game.</p>
        <div id="skin-list" style="width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 50px;">
            </div>
    </div>

    <script>
        const LocalState = { user: null, data: {}, isEditing: false };

        window.App = window.App || {}; 

        window.App.init = () => {
            const savedUser = localStorage.getItem('ms_user');
            if (savedUser) {
                LocalState.user = savedUser;
                App.finishLogin();
            } else {
                document.getElementById('screen-login').classList.add('active');
            }

            if(window.App.applySkin) window.App.applySkin();

            try {
                db.ref('waiting').on('value', snap => {
                    const count = snap.exists() ? Object.keys(snap.val()).length : 0;
                    const el = document.getElementById('stat-wait');
                    if(el) el.innerText = count;
                });
            } catch(e) { console.log("Firebase wait error", e); }
        };

        window.App.renderSkins = () => {
            const currentSkin = localStorage.getItem('ms_skin') || 'default';
            const container = document.getElementById('skin-list');
            container.innerHTML = '';

            const skins = window.SKINS || [];
            
            skins.forEach(skin => {
                const isActive = skin.id === currentSkin;
                const btn = document.createElement('div');
                
                // Style cho item chá»n skin
                btn.style.cssText = `
                    padding: 15px; cursor: pointer; transition: 0.2s;
                    border: 3px solid ${isActive ? '#10b981' : 'transparent'};
                    background: ${skin.color};
                    color: ${skin.id === 'default' ? 'white' : 'black'};
                    display: flex; align-items: center; gap: 15px; text-align: left;
                    border-radius: 16px;
                    opacity: ${isActive ? '1' : '0.8'};
                    transform: ${isActive ? 'scale(1.02)' : 'scale(1)'};
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    margin-bottom: 10px;
                `;
                
                btn.onclick = () => {
                    localStorage.setItem('ms_skin', skin.id);
                    window.App.renderSkins();      
                };

                btn.innerHTML = `
                    <div style="font-size: 2rem;">
                        ${skin.id === 'classic' ? 'ğŸªŸ' : (skin.id === 'pink' ? 'ğŸŒ¸' : 'ğŸ’ ')}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 900; font-size: 1.1rem;">${skin.name}</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">${skin.desc}</div>
                    </div>
                    <div style="font-size: 1.5rem;">${isActive ? 'âœ…' : ''}</div>
                `;
                container.appendChild(btn);
            });
        };

        window.App.login = () => {
            const name = document.getElementById('inp-name').value.trim().replace(/[^a-zA-Z0-9]/g, "");
            if (name.length < 2) return alert("TÃªn quÃ¡ ngáº¯n!");
            
            document.getElementById('btn-login').innerText = "Äang táº£i...";
            LocalState.user = name;

            db.ref('users/' + name).once('value').then(snap => {
                if (snap.exists()) {
                    LocalState.data = snap.val();
                    if (!LocalState.data.achievements) LocalState.data.achievements = {};
                    
                    if (LocalState.isEditing) {
                        document.getElementById('inp-desc').value = LocalState.data.desc || "";
                        document.getElementById('welcome-user').innerText = `Cáº­p nháº­t: ${name}`;
                        App.showScreen('slogan');
                    } else {
                        localStorage.setItem('ms_user', name);
                        App.finishLogin();
                    }
                } else {
                    LocalState.data = { wins: 0, losses: 0, desc: "", achievements: {} };
                    document.getElementById('welcome-user').innerText = `Xin chÃ o ${name}!`;
                    App.showScreen('slogan');
                }
            }).catch(e => {
                alert("Lá»—i káº¿t ná»‘i: " + e.message);
                document.getElementById('btn-login').innerText = "TIáº¾P Tá»¤C";
            });
        };

        window.App.saveSlogan = () => {
            const desc = document.getElementById('inp-desc').value.trim();
            LocalState.data.desc = desc;
            
            db.ref('users/' + LocalState.user).update(LocalState.data).then(() => {
                localStorage.setItem('ms_user', LocalState.user);
                LocalState.isEditing = false;
                App.finishLogin();
            });
        };

        window.App.finishLogin = () => {
            document.getElementById('u-name').innerText = LocalState.user;
            document.getElementById('user-badge').style.display = 'flex';
            document.getElementById('btn-login').innerText = "TIáº¾P Tá»¤C";
            document.getElementById('btn-cancel-login').style.display = 'none';
            App.showMenu();
        };

        window.App.editProfile = () => {
            LocalState.isEditing = true;
            document.getElementById('inp-name').value = LocalState.user;
            document.getElementById('btn-login').innerText = "Cáº¬P NHáº¬T";
            document.getElementById('btn-cancel-login').style.display = 'block';
            App.showScreen('login');
        };

        window.App.logout = () => {
            localStorage.removeItem('ms_user');
            location.reload();
        };

        window.App.showMenu = () => {
            LocalState.isEditing = false;
            App.showScreen('menu');
        };

        window.App.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
                s.style.display = 'none'; 
            });
            const target = document.getElementById('screen-' + id);
            if(target) {
                target.classList.add('active');
                target.style.display = 'flex';
            }
            if (id === 'skins') {
                window.App.renderSkins();
            }
        };

        window.onload = window.App.init;
    </script>
</body>
</html>
