<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="config.js"></script>
</head>
<body>
    <div id="screen-login" class="screen" style="display: flex;">
        <div class="card">
            <h1>ÄÄ‚NG NHáº¬P</h1>
            <input type="text" id="inp-name" placeholder="Nháº­p tÃªn cá»§a báº¡n" maxlength="12">
            <button class="btn btn-primary" onclick="login()" style="width:100%">Báº®T Äáº¦U</button>
        </div>
    </div>

    <div id="screen-menu" class="screen" style="display: none;">
        <div id="user-badge" style="display: flex;">ğŸ‘¤ <span id="u-name">...</span></div>
        <h1>MENU</h1>
        <button class="btn btn-primary" onclick="window.location.href='choi.html'">ğŸ® CHÆ I ÄÆ N</button>
        <button class="btn btn-pvp" onclick="window.location.href='choi.html?mode=pvp'">
            <div style="font-size:1.1rem; font-weight:900">âš”ï¸ Äáº¤U PVP</div>
            <div class="pvp-stats">Chá»: <span id="stat-wait">0</span></div>
        </button>
        <button class="btn" onclick="window.location.href='xephang.html'">ğŸ† Báº¢NG Xáº¾P Háº NG</button>
        <button class="btn btn-gold" onclick="window.location.href='thanhtuu.html'">ğŸ–ï¸ THÃ€NH Tá»°U</button>
        <button class="btn btn-danger" onclick="logout()">ÄÄ‚NG XUáº¤T</button>
    </div>

    <script>
        // Kiá»ƒm tra náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p thÃ¬ hiá»‡n menu luÃ´n
        const savedUser = localStorage.getItem('ms_user');
        if(savedUser) {
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('screen-menu').style.display = 'flex';
            document.getElementById('u-name').innerText = savedUser;
            initStats();
        }

        function login() {
            const name = document.getElementById('inp-name').value.trim().replace(/[^a-zA-Z0-9]/g, "");
            if(name.length < 2) return alert("TÃªn quÃ¡ ngáº¯n!");
            
            // LÆ°u vÃ o localStorage
            localStorage.setItem('ms_user', name);
            
            // Táº¡o dá»¯ liá»‡u trÃªn Firebase náº¿u chÆ°a cÃ³
            db.ref('users/' + name).once('value', snap => {
                if(!snap.exists()) {
                    db.ref('users/' + name).set({ wins: 0, losses: 0, desc: "TÃ¢n binh", achievements: {} });
                }
            });

            // Reload Ä‘á»ƒ vÃ o menu
            location.reload();
        }

        function logout() {
            localStorage.removeItem('ms_user');
            location.reload();
        }

        function initStats() {
            db.ref('waiting').on('value', snap => {
                var count = snap.exists() ? Object.keys(snap.val()).length : 0;
                document.getElementById('stat-wait').innerText = count;
            });
        }
    </script>
</body>
</html>
